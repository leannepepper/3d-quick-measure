import*as e from"three";import{Line as t,Html as r,Select as n}from"@react-three/drei";import{extend as a,useThree as o,useFrame as i}from"@react-three/fiber";import*as c from"react";import{useContext as l,useCallback as s,useRef as m,useMemo as u,useState as p,useEffect as d}from"react";import{EffectComposer as f}from"three/examples/jsm/postprocessing/EffectComposer";import{OutlinePass as h}from"three/examples/jsm/postprocessing/OutlinePass";import{RenderPass as x}from"three/examples/jsm/postprocessing/RenderPass";function v(){return v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},v.apply(this,arguments)}function g(t){var r=new e.Vector3;return r.x=(t[1].x+t[0].x)/2,r.y=(t[1].y+t[0].y)/2,r.z=(t[1].z+t[0].z)/2,r}function E(t){var r=new e.Box3,n=new e.Group,a=[];return t.forEach(function(e){var t=e.clone();a.push(t)}),n.add.apply(n,a),r.setFromObject(n),r}function y(t){var r=v({},t).multiSelected;if(r.length<2)return null;var n=E(r);/*#__PURE__*/return c.createElement("box3Helper",{box:n,args:[n,new e.Color(16777215)]})}function w(e,t,r,n,a){return e[0].position[a]>t[0].position[a]?[n.max[a],r.max[a]]:e[0].position[a]<t[0].position[a]?[n.min[a],r.min[a]]:[n.max[a],r.max[a]]}function b(e,t,r){var n=e.min[r];return[t.min[r],t.max[r]].reduce(function(e,t){return Math.abs(t-n)<Math.abs(e-n)?t:e})}function z(e,t,r,n){return e[0].position[n]>t[0].position[n]?r.min[n]:e[0].position[n]<t[0].position[n]?r.max[n]:r.min[n]}function C(n){var a=n.hovered,o=n.selected;if(0===o.length||0===a.length)return null;var i=E(o);a[0].geometry.computeBoundingBox();var l=a[0].geometry.boundingBox.clone();l.applyMatrix4(a[0].matrixWorld);var s=w(o,a,i,l,"x"),m=s[0],u=s[1],p=w(o,a,i,l,"y"),d=p[0],f=p[1],h=w(o,a,i,l,"z"),x=h[0],v=h[1],y=[new e.Vector3(m,b(i,l,"y"),l.max.z),new e.Vector3(u,b(i,l,"y"),l.max.z)],C=[new e.Vector3(b(i,l,"x"),d,l.max.z),new e.Vector3(b(i,l,"x"),f,l.max.z)],O=[new e.Vector3(b(i,l,"x"),b(i,l,"y"),x),new e.Vector3(b(i,l,"x"),b(i,l,"y"),v)],P=[new e.Vector3(b(i,l,"x"),g([i.min,i.max]).y,l.max.z),new e.Vector3(z(o,a,i,"x"),g([i.min,i.max]).y,l.max.z)],V=[new e.Vector3(g([i.min,i.max]).x,b(i,l,"y"),l.max.z),new e.Vector3(g([i.min,i.max]).x,z(o,a,i,"y"),l.max.z)];/*#__PURE__*/return c.createElement(c.Fragment,null,/*#__PURE__*/c.createElement(t,{points:y,color:"#41a5f5",lineWidth:1,dashed:!0,dashScale:10,alphaWrite:void 0}),/*#__PURE__*/c.createElement(t,{points:C,color:"#41a5f5",lineWidth:1,dashed:!0,dashScale:10,alphaWrite:void 0}),/*#__PURE__*/c.createElement(t,{points:O,color:"#41a5f5",lineWidth:1,dashed:!0,dashScale:10,alphaWrite:void 0},/*#__PURE__*/c.createElement("group",{position:g(O)},/*#__PURE__*/c.createElement(r,{as:"div",wrapperClass:"measure-text",zIndexRange:[100,0],center:!0,transform:!1,sprite:!0},/*#__PURE__*/c.createElement("p",null,Math.round(Math.abs(O[0].z-O[1].z)))))),/*#__PURE__*/c.createElement(t,{points:P,color:"#f17720",lineWidth:1,alphaWrite:void 0},/*#__PURE__*/c.createElement("group",{position:g(P)},/*#__PURE__*/c.createElement(r,{as:"div",wrapperClass:"measure-text",zIndexRange:[100,0],center:!0,transform:!1,sprite:!0},/*#__PURE__*/c.createElement("p",null,Math.round(Math.abs(P[0].x-P[1].x)))))),/*#__PURE__*/c.createElement(t,{points:V,color:"#f17720",lineWidth:1,alphaWrite:void 0},/*#__PURE__*/c.createElement("group",{position:g(V)},/*#__PURE__*/c.createElement(r,{as:"div",wrapperClass:"measure-text",zIndexRange:[100,0],center:!0,transform:!1,sprite:!0},/*#__PURE__*/c.createElement("p",null,Math.round(Math.abs(V[0].y-V[1].y)))))))}var O=c.createContext(null),P=c.createContext(null);function V(e){var t=e.children,r=l(O),n=l(P),a=s(function(e){r(function(t){return n.includes(e.object)?[]:[].concat(t,[e.object])})},[n]),o=s(function(e){r([])},[]);/*#__PURE__*/return c.createElement("group",{onPointerOver:a,onPointerOut:o},t)}var j=["children"];function W(t){var r=t.children;!function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t.indexOf(r=o[n])>=0||(a[r]=e[r])}(t,j);var a=m(null),l=o(),s=l.scene,f=l.gl,h=l.size,x=l.camera,v=u(function(){return new e.Vector2(1024,1024)},[]),g=p([]),E=g[0],w=g[1],b=p([]),z=b[0],W=b[1];return d(function(){a.current&&a.current.setSize(h.width,h.height)},[h]),i(function(){a.current&&a.current.render(),z.length>0&&W(function(e){return[].concat(e)})},1),/*#__PURE__*/c.createElement(O.Provider,{value:w},/*#__PURE__*/c.createElement(P.Provider,{value:z},/*#__PURE__*/c.createElement(n,{box:!0,multiple:!0,onChange:function(e){w([]),W(e)}},/*#__PURE__*/c.createElement(V,null,r)),/*#__PURE__*/c.createElement(y,{multiSelected:z}),/*#__PURE__*/c.createElement(C,{selected:z,hovered:E}),/*#__PURE__*/c.createElement("effectComposer",{ref:a,args:[f]},/*#__PURE__*/c.createElement("renderPass",{attachArray:"passes",scene:s,camera:x}),/*#__PURE__*/c.createElement("outlinePass",{attachArray:"passes",args:[v,s,x],selectedObjects:E,visibleEdgeColor:new e.Color(292026)}),/*#__PURE__*/c.createElement("outlinePass",{attachArray:"passes",args:[v,s,x],selectedObjects:z,visibleEdgeColor:new e.Color(16777215),edgeStrength:10,edgeThickness:.25}))))}a({EffectComposer:f,RenderPass:x,OutlinePass:h});export{W as QuickMeasure};
//# sourceMappingURL=index.esm.js.map
