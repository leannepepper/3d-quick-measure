import*as e from"three";import{Line as t,Html as r,Select as n}from"@react-three/drei";import{extend as o,useThree as a,useFrame as s}from"@react-three/fiber";import*as c from"react";import{useContext as i,useCallback as l,useRef as m,useMemo as p,useState as u,useEffect as d}from"react";import{EffectComposer as h}from"three/examples/jsm/postprocessing/EffectComposer";import{OutlinePass as x}from"three/examples/jsm/postprocessing/OutlinePass";import{RenderPass as f}from"three/examples/jsm/postprocessing/RenderPass";function g(){return g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g.apply(this,arguments)}function E(t){const r=new e.Vector3;return r.x=(t[1].x+t[0].x)/2,r.y=(t[1].y+t[0].y)/2,r.z=(t[1].z+t[0].z)/2,r}function y(t){const r=new e.Box3,n=new e.Group,o=[];return t.forEach(e=>{const t=e.clone();o.push(t)}),n.add(...o),r.setFromObject(n),r}function w(t){let r=g({},t);const{multiSelected:n}=r;if(n.length<2)return null;const o=y(n);/*#__PURE__*/return c.createElement("box3Helper",{box:o,args:[o,new e.Color(16777215)]})}function v(e,t,r,n,o){return e[0].position[o]>t[0].position[o]?[n.max[o],r.max[o]]:e[0].position[o]<t[0].position[o]?[n.min[o],r.min[o]]:[n.max[o],r.max[o]]}function b(e,t,r){const n=e.min[r];return[t.min[r],t.max[r]].reduce(function(e,t){return Math.abs(t-n)<Math.abs(e-n)?t:e})}function z(e,t,r,n){return e[0].position[n]>t[0].position[n]?r.min[n]:e[0].position[n]<t[0].position[n]?r.max[n]:r.min[n]}function C(n){const{hovered:o,selected:a}=n;if(0===a.length||0===o.length)return null;const s=y(a);o[0].geometry.computeBoundingBox();const i=o[0].geometry.boundingBox.clone();i.applyMatrix4(o[0].matrixWorld);const[l,m]=v(a,o,s,i,"x"),[p,u]=v(a,o,s,i,"y"),[d,h]=v(a,o,s,i,"z"),x=[new e.Vector3(l,b(s,i,"y"),i.max.z),new e.Vector3(m,b(s,i,"y"),i.max.z)],f=[new e.Vector3(b(s,i,"x"),p,i.max.z),new e.Vector3(b(s,i,"x"),u,i.max.z)],g=[new e.Vector3(b(s,i,"x"),b(s,i,"y"),d),new e.Vector3(b(s,i,"x"),b(s,i,"y"),h)],w=[new e.Vector3(b(s,i,"x"),E([s.min,s.max]).y,i.max.z),new e.Vector3(z(a,o,s,"x"),E([s.min,s.max]).y,i.max.z)],C=[new e.Vector3(E([s.min,s.max]).x,b(s,i,"y"),i.max.z),new e.Vector3(E([s.min,s.max]).x,z(a,o,s,"y"),i.max.z)];/*#__PURE__*/return c.createElement(c.Fragment,null,/*#__PURE__*/c.createElement(t,{points:x,color:"#41a5f5",lineWidth:1,dashed:!0,dashScale:10,alphaWrite:void 0}),/*#__PURE__*/c.createElement(t,{points:f,color:"#41a5f5",lineWidth:1,dashed:!0,dashScale:10,alphaWrite:void 0}),/*#__PURE__*/c.createElement(t,{points:g,color:"#41a5f5",lineWidth:1,dashed:!0,dashScale:10,alphaWrite:void 0},/*#__PURE__*/c.createElement("group",{position:E(g)},/*#__PURE__*/c.createElement(r,{as:"div",wrapperClass:"measure-text",zIndexRange:[100,0],center:!0,transform:!1,sprite:!0},/*#__PURE__*/c.createElement("p",null,Math.round(Math.abs(g[0].z-g[1].z)))))),/*#__PURE__*/c.createElement(t,{points:w,color:"#f17720",lineWidth:1,alphaWrite:void 0},/*#__PURE__*/c.createElement("group",{position:E(w)},/*#__PURE__*/c.createElement(r,{as:"div",wrapperClass:"measure-text",zIndexRange:[100,0],center:!0,transform:!1,sprite:!0},/*#__PURE__*/c.createElement("p",null,Math.round(Math.abs(w[0].x-w[1].x)))))),/*#__PURE__*/c.createElement(t,{points:C,color:"#f17720",lineWidth:1,alphaWrite:void 0},/*#__PURE__*/c.createElement("group",{position:E(C)},/*#__PURE__*/c.createElement(r,{as:"div",wrapperClass:"measure-text",zIndexRange:[100,0],center:!0,transform:!1,sprite:!0},/*#__PURE__*/c.createElement("p",null,Math.round(Math.abs(C[0].y-C[1].y)))))))}const O=c.createContext(null),P=c.createContext(null);function V({children:e}){const t=i(O),r=i(P),n=l(e=>{t(t=>r.includes(e.object)?[]:[...t,e.object])},[r]),o=l(e=>{t([])},[]);/*#__PURE__*/return c.createElement("group",{onPointerOver:n,onPointerOut:o},e)}const j=["children"];function W(t){let{children:r}=t;!function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(r=a[n])>=0||(o[r]=e[r])}(t,j);const o=m(null),{scene:i,gl:l,size:h,camera:x}=a(),f=p(()=>new e.Vector2(1024,1024),[]),[g,E]=u([]),[y,v]=u([]);return d(()=>{o.current&&o.current.setSize(h.width,h.height)},[h]),s(()=>{o.current&&o.current.render(),y.length>0&&v(e=>[...e])},1),/*#__PURE__*/c.createElement(O.Provider,{value:E},/*#__PURE__*/c.createElement(P.Provider,{value:y},/*#__PURE__*/c.createElement(n,{box:!0,multiple:!0,onChange:e=>{E([]),v(e)}},/*#__PURE__*/c.createElement(V,null,r)),/*#__PURE__*/c.createElement(w,{multiSelected:y}),/*#__PURE__*/c.createElement(C,{selected:y,hovered:g}),/*#__PURE__*/c.createElement("effectComposer",{ref:o,args:[l]},/*#__PURE__*/c.createElement("renderPass",{attachArray:"passes",scene:i,camera:x}),/*#__PURE__*/c.createElement("outlinePass",{attachArray:"passes",args:[f,i,x],selectedObjects:g,visibleEdgeColor:new e.Color(292026)}),/*#__PURE__*/c.createElement("outlinePass",{attachArray:"passes",args:[f,i,x],selectedObjects:y,visibleEdgeColor:new e.Color(16777215),edgeStrength:10,edgeThickness:.25}))))}o({EffectComposer:h,RenderPass:f,OutlinePass:x});export{W as QuickMeasure};
//# sourceMappingURL=index.modern.js.map
